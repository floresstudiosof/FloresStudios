<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FLORES Studios | Descargar Videos de TikTok</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body{
  background:#f2f4f8;
  font-family:Arial, sans-serif;
}

.app-card{
  background:white;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.15);
}

.download-btn{
  display:block;
  text-align:center;
  padding:14px;
  border-radius:12px;
  font-weight:600;
  background:linear-gradient(135deg,#4e73df,#224abe);
  color:white;
  transition:0.3s;
}

.download-btn:hover{
  transform:translateY(-3px);
  box-shadow:0 8px 20px rgba(0,0,0,0.3);
}

.counter-box{
  background:#eef2ff;
  padding:10px;
  border-radius:10px;
  font-size:14px;
  text-align:center;
  color:#224abe;
  margin-top:10px;
}

.loader{
  border:6px solid #ddd;
  border-top:6px solid #224abe;
  border-radius:50%;
  width:40px;
  height:40px;
  animation:spin 1s linear infinite;
  margin:auto;
}

@keyframes spin{
  to{transform:rotate(360deg);}
}
</style>
</head>

<body class="p-4">

<div class="max-w-md mx-auto app-card p-6">

<h2 class="text-2xl font-bold text-center mb-4 text-gray-800">
FLORES Studios<br>
<span class="text-base font-normal">Descargar Videos de TikTok</span>
</h2>

<input id="videoURL"
class="w-full p-3 border rounded-xl mb-3"
placeholder="Pega enlace de TikTok">

<button onclick="processTikTok()"
class="w-full p-3 rounded-xl download-btn">
DESCARGAR
</button>

<div id="loading" class="hidden mt-4">
<div class="loader"></div>
</div>

<div id="previewContainer" class="hidden mt-5">

<img id="thumbnail"
class="w-full rounded-xl mb-3 hidden">

<video id="previewVideo"
controls
class="w-full rounded-xl hidden">
</video>

<div class="grid gap-3 mt-4">

<a id="downloadMP4"
class="hidden download-btn"
onclick="countDownload()">
⬇ Descargar MP4
</a>

<a id="downloadHD"
class="hidden download-btn"
onclick="countDownload()">
⬇ Descargar MP4 HD
</a>

<a id="downloadMP3"
class="hidden download-btn"
onclick="countDownload()">
⬇ Descargar MP3
</a>

</div>

<div id="counterBox" class="counter-box hidden">
Descargas totales: <span id="downloadCount">0</span>
</div>

</div>
</div>

<script>

let totalDownloads = 0;

function countDownload(){
  totalDownloads++;
  document.getElementById('downloadCount').innerText = totalDownloads;
  document.getElementById('counterBox').classList.remove('hidden');
}

async function processTikTok(){

const url = document.getElementById('videoURL').value.trim();

const loading = document.getElementById('loading');
const previewContainer = document.getElementById('previewContainer');
const previewVideo = document.getElementById('previewVideo');
const thumbnail = document.getElementById('thumbnail');

const downloadMP4 = document.getElementById('downloadMP4');
const downloadHD = document.getElementById('downloadHD');
const downloadMP3 = document.getElementById('downloadMP3');

if(!url || !url.includes('tiktok.com')){
alert('Enlace inválido');
return;
}

previewContainer.classList.add('hidden');
downloadMP4.classList.add('hidden');
downloadHD.classList.add('hidden');
downloadMP3.classList.add('hidden');
thumbnail.classList.add('hidden');
previewVideo.classList.add('hidden');

loading.classList.remove('hidden');

try{

const apiURL = `https://api.tiklydown.eu.org/api/download?url=${encodeURIComponent(url)}`;
const res = await fetch(apiURL);
const json = await res.json();

if(!json.video) throw new Error();

if(json.thumbnail){
  thumbnail.src = json.thumbnail;
  thumbnail.classList.remove('hidden');
}

previewVideo.src = json.video;
previewVideo.classList.remove('hidden');

downloadMP4.href = json.video;
downloadMP4.target = "_blank";
downloadMP4.classList.remove('hidden');

if(json.video_hd){
  downloadHD.href = json.video_hd;
  downloadHD.target = "_blank";
  downloadHD.classList.remove('hidden');
}

if(json.music){
  downloadMP3.href = json.music;
  downloadMP3.target = "_blank";
  downloadMP3.classList.remove('hidden');
}

previewContainer.classList.remove('hidden');

}catch{
alert('Error al procesar el enlace');
}

loading.classList.add('hidden');
}

</script>

</body>
</html>